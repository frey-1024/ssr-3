const merge = require('webpack-merge');const webpack = require('webpack');const baseConfig = require('./webpack.base.config');const config = require('./config')[process.env.NODE_ENV];const nodeExternals = require('webpack-node-externals');const { resolve } = require('./utils');const cssRegex = /\.css$/;const cssModuleRegex = /\.module\.css$/;const sassRegex = /\.(scss|sass)$/;const sassModuleRegex = /\.module\.(scss|sass)$/;module.exports = merge(baseConfig(config), {  target: 'node',  devtool: config.devtool,  mode: config.env,  entry: resolve('src/server-entry.js'),  output: {    filename: 'server-bundle.js',    libraryTarget: 'commonjs2',    publicPath: '/',    chunkFilename: config.noHash ? '[name].js' : 'js/[name].[chunkhash].js'  },  module: {    rules: [      {        oneOf: [          {            test: cssRegex,            exclude: cssModuleRegex,            use: [              {                loader: require.resolve('ignore-loader')              }            ]          },          {            test: sassRegex,            exclude: sassModuleRegex,            use: [              {                loader: require.resolve('ignore-loader')              }            ]          }        ]      }    ]  },  // 服务端打包的时候忽略外部的npm包  externals: nodeExternals({    // 当然外部的css还是可以打进来的    whitelist: /\.(css|less|scss)$/  }),  plugins: [    new webpack.DefinePlugin({      'process.env.NODE_ENV': JSON.stringify(config.env),      'process.env.VUE_ENV': '"server"'    })  ]});